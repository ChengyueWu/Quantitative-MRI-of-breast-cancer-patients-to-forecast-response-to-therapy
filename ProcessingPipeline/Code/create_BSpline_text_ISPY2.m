% % create_job_text.m

Patient_List = {...
'103939'...
'104268'...
'148357'...
'165925'...
'209967'...
'213913'...
'219545'...
'220925'...
'221686'...
'277888'...
'296123'...
'356431'...
'408692'...
'465008'...
'516834'...
'522140'...
'547892'...
'580632'...
'706639'...
'734997'...
'774840'...
'794128'...
'795996'...
'799149'...
'843554'...
'884011'...
'928170'...
'963303'...
'970839'...
'973837'...
'987728'...
'116603'...
'138027'...
'139973'...
'152090'...
'188700'...
'233191'...
'241998'...
'280375'...
'285339'...
'289420'...
'293142'...
'294739'...
'296841'...
'299962'...
'328160'...
'355942'...
'376676'...
'396723'...
'397505'...
'407539'...
'409288'...
'412772'...
'413211'...
'414844'...
'435279'...
'460642'...
'462582'...
'467686'...
'474874'...
'511851'...
'520471'...
'524170'...
'531988'...
'580541'...
'587604'...
'587691'...
'607843'...
'618717'...
'653927'...
'663144'...
'689452'...
'691753'...
'698094'...
'711476'...
'712785'...
'724384'...
'728149'...
'738041'...
'748611'...
'760011'...
'760901'...
'775346'...
'783764'...
'800447'...
'820807'...
'831848'...
'866660'...
'879224'...
'890372'...
'896852'...
'900959'...
'913527'...
'938719'...
'942017'...
'955035'...
'982086'...
'991818'...
'995480'...
};

time_list = {'T0','T2'};
for pidx = 1:length(Patient_List)
    for j = 1:2
	    pt = Patient_List{pidx};
        time = time_list{j};
	    filename = ['/Users/rp33847/UserFolders/ISPY2/Data/Processed/','BSpline_Rigid_Penalty',time,'_',pt,'.txt'];
	    fileID = fopen(filename,'W');
	    
		    fprintf(fileID,'(FixedInternalImagePixelType "float")\n');
	    fprintf(fileID,'(MovingInternalImagePixelType "float")\n\n');
    
	    fprintf(fileID,'////////////////// Components /////////////////////\n');
	    fprintf(fileID,'(Registration "MultiMetricMultiResolutionRegistration")\n\n');
    
	    fprintf(fileID,'(FixedImagePyramid "FixedRecursiveImagePyramid")\n');
	    fprintf(fileID,'(MovingImagePyramid "MovingRecursiveImagePyramid")\n');
	    fprintf(fileID,'(Interpolator "BSplineInterpolator")\n');
	    fprintf(fileID,'(ResampleInterpolator "FinalBSplineInterpolator")\n');
	    fprintf(fileID,'(Resampler "DefaultResampler")\n\n');
    
	    fprintf(fileID,'(Metric "AdvancedMattesMutualInformation" "TransformRigidityPenalty")\n\n');
    
	    fprintf(fileID,'(Optimizer "StandardGradientDescent")\n');
	    fprintf(fileID,'(Transform "BSplineTransform")\n\n');
    
	    fprintf(fileID,'////////////////////// Transform ///////////////////\n');
        fprintf(fileID,'(FinalGridSpacing 8.0)\n');
	    fprintf(fileID,'(UpsampleGridOption "true")\n\n');
    
	    fprintf(fileID,'///////////////////// Multi resolution /////////////\n');
        fprintf(fileID,'(NumberOfResolutions 4)\n\n');

	    fprintf(fileID,'/////////////////// Sampling /////////////////\n');
        fprintf(fileID,'(ImageSampler "Random")\n');
        fprintf(fileID,'(NewSamplesEveryIteration "true")\n');
        fprintf(fileID,'(NumberOfSpatialSamples 5000 5000 5000 5000)\n');
	    fprintf(fileID,'(ErodeMask "true")\n\n');
    
	    fprintf(fileID,'///////////////// Interpolation and resampling /////////////////////\n');
        fprintf(fileID,'(BSplineInterpolationOrder 1)\n');
        fprintf(fileID,'(FinalBSplineInterpolationOrder 3)\n');
	    fprintf(fileID,'(DefaultPixelValue 0)\n\n');

	    fprintf(fileID,'//////////////// Output and other /////////////////////////\n');
        fprintf(fileID,'(WriteTransformParametersEachIteration "false" "false" "false" "false")\n');
        fprintf(fileID,'(WriteTransformParametersEachResolution "true" "true" "true" "true")\n');
        fprintf(fileID,'(ShowExactMetricValue "false" "false" "false" "false")\n');
        fprintf(fileID,'(WriteResultImageAfterEachResolution "false")\n');
	    fprintf(fileID,'(ResultImagePixelType "short")\n\n');
        
        fprintf(fileID,'//////////// Optimiser ////////////////////\n');
        fprintf(fileID,'// SP: a_k = a/(A+k+1)^alpha\n');
        fprintf(fileID,'(MaximumNumberOfIterations 300 300 300 1200)\n');
        fprintf(fileID,'(SP_a 150000.0 120000.0 70000.0 20000.0)\n');
        fprintf(fileID,'(SP_alpha 0.602 0.602 0.602 0.602)\n');
	    fprintf(fileID,'(SP_A 100.0 100.0 100.0 100.0)\n\n');

        fprintf(fileID,'//////////////// Metric ////////////////////\n');
        fprintf(fileID,'(NumberOfHistogramBins 32 32 32 32)\n\n');

        fprintf(fileID,'/////////////// MMIWRR specific //////////////\n');
        fprintf(fileID,'(Metric0Weight 1.0)\n');
	    fprintf(fileID,'(Metric1Weight 0.1)\n\n');

        fprintf(fileID,'(LinearityConditionWeight 50.0)\n');
        fprintf(fileID,'(OrthonormalityConditionWeight 1.0)\n');
        fprintf(fileID,'(PropernessConditionWeight 2.0)\n');
        fprintf(fileID,'(UseLinearityCondition "true")\n');
        fprintf(fileID,'(UseOrthonormalityCondition "true")\n');
        fprintf(fileID,'(UsePropernessCondition "true")\n');
        fprintf(fileID,'(CalculateLinearityCondition "true")\n');
        fprintf(fileID,'(CalculateOrthonormalityCondition "true")\n');
        fprintf(fileID,'(CalculatePropernessCondition "true")\n');
        fprintf(fileID,'(DilateRigidityImages "false" "false" "false" "true")\n');
        fprintf(fileID,'(DilationRadiusMultiplier 2.0)\n\n');

        fprintf(fileID,'(UseFixedRigidityImage "false")\n');
        fprintf(fileID,'(UseMovingRigidityImage "true")\n\n');

        fprintf(fileID,['(MovingRigidityImageName "/Volumes/SanDiskSSD/ISPY2/Data/Processed/',pt,'/IntervisitRegistered/RegFiles/',pt,time,'_TumorMask_hs.mhd")\n\n\n\n\n']);

        fclose(fileID);
    end
end
